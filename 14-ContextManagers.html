<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>14-ContextManagers</title>

<script type="text/javascript" src="14-ContextManagers_files/MathJax.js" charset="utf-8"></script>

<script type="text/javascript">
// MathJax disabled, set as null to distingish from *missing* MathJax,
// where it will be undefined, and should prompt a dialog later.
window.mathjax_url = "mathjax/MathJax.js";
</script>
<link rel="stylesheet" href="14-ContextManagers_files/jquery-wijmo.css" type="text/css">
<link rel="stylesheet" href="14-ContextManagers_files/codemirror.css">
<link rel="stylesheet" href="14-ContextManagers_files/markdown.css">
<link rel="stylesheet" href="14-ContextManagers_files/rst.css">
<link rel="stylesheet" href="14-ContextManagers_files/ipython.css">
<link rel="stylesheet" href="14-ContextManagers_files/default.css">
<link rel="stylesheet" href="14-ContextManagers_files/prettify.css">
<link rel="stylesheet" href="14-ContextManagers_files/boilerplate.css" type="text/css">
<link rel="stylesheet" href="14-ContextManagers_files/layout.css" type="text/css">
<link rel="stylesheet" href="14-ContextManagers_files/base.css" type="text/css">
<link rel="stylesheet" href="14-ContextManagers_files/notebook.css" type="text/css">
<link rel="stylesheet" href="14-ContextManagers_files/renderedhtml.css" type="text/css">


<meta name="read_only" content="False">
<style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-family: serif; font-size: 85%; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuTitle {background-color: #CCCCCC; margin: -5px 0 0 0; text-align: center; font-style: italic; font-size: 80%; color: #444444; padding: 2px 0; overflow: hidden}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
</style><style type="text/css">#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">@media print { body { overflow: visible !important; } }.ui-widget-content { border: 0px; }</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-family: serif; font-size: 85%; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuTitle {background-color: #CCCCCC; margin: -5px 0 0 0; text-align: center; font-style: italic; font-size: 80%; color: #444444; padding: 2px 0; overflow: hidden}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
</style><style type="text/css">#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style></head><body style="overflow: auto;"><div tabindex="2" class="cell text_cell border-box-sizing ui-widget-content ui-corner-all"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 1px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><h1>Context Managers</h1></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[2]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 65px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>with open('/etc/hosts') as fp:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">open</span><span class="cm-null">(</span><span class="cm-string">'/etc/hosts'</span><span class="cm-null">) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">fp</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-variable">fp.read</span><span class="cm-null">()</span></pre><pre><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-variable">fp</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>127.0.0.1	localhost
127.0.1.1	precise64

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

&lt;closed file '/etc/hosts', mode 'r' at 0x1882930&gt;</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[5]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 153px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    with open('/etc/hosts') as fp:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">try</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">open</span><span class="cm-null">(</span><span class="cm-string">'/etc/hosts'</span><span class="cm-null">) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">fp</span><span class="cm-null">:</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">raise</span><span class="cm-null"> </span><span class="cm-variable">KeyError</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-variable">fp.read</span><span class="cm-null">()</span></pre><pre><span class="cm-keyword">except</span><span class="cm-null"> </span><span class="cm-variable">KeyError</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'handle keyerror'</span></pre><pre> </pre><pre><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-variable">fp</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>handle keyerror
&lt;closed file '/etc/hosts', mode 'r' at 0x1882930&gt;</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[7]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 47px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>with open('/etc/hosts') as fp_i, open('/tmp/hosts', 'w') as fp_o:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">open</span><span class="cm-null">(</span><span class="cm-string">'/etc/hosts'</span><span class="cm-null">) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">fp_i</span><span class="cm-null">, </span><span class="cm-variable">open</span><span class="cm-null">(</span><span class="cm-string">'/tmp/hosts'</span><span class="cm-null">, </span><span class="cm-string">'w'</span><span class="cm-null">) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">fp_o</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-variable">fp_o.write</span><span class="cm-null">(</span><span class="cm-variable">fp_i.read</span><span class="cm-null">())</span></pre></div></div></div></div></div></div></div></div></div><div style="display: none;" class="output vbox"></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[8]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 47px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>with open('/tmp/hosts') as fp:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">open</span><span class="cm-null">(</span><span class="cm-string">'/tmp/hosts'</span><span class="cm-null">) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">fp</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-variable">fp.read</span><span class="cm-null">()</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>127.0.0.1	localhost
127.0.1.1	precise64

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</pre></div></div></div></div><div tabindex="2" class="cell text_cell border-box-sizing"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 1px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><h2>Context manager protocol</h2></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[16]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 223px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>        print 'Swallowing %s inside CM' % ex_type</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">class</span><span class="cm-null"> </span><span class="cm-variable">CM</span><span class="cm-null">(</span><span class="cm-builtin">object</span><span class="cm-null">):</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">def</span><span class="cm-null"> </span><span class="cm-variable">__enter__</span><span class="cm-null">(</span><span class="cm-variable">self</span><span class="cm-null">):</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Entering CM'</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">return</span><span class="cm-null"> </span><span class="cm-variable">self</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">def</span><span class="cm-null"> </span><span class="cm-variable">__exit__</span><span class="cm-null">(</span><span class="cm-variable">self</span><span class="cm-null">, </span><span class="cm-variable">ex_type</span><span class="cm-null">, </span><span class="cm-variable">ex_val</span><span class="cm-null">, </span><span class="cm-variable">ex_tb</span><span class="cm-null">):</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Exiting CM'</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">if</span><span class="cm-null"> </span><span class="cm-variable">ex_type</span><span class="cm-null"> </span><span class="cm-operator">==</span><span class="cm-null"> </span><span class="cm-variable">KeyError</span><span class="cm-null">: </span></pre><pre><span class="cm-null">            </span><span class="cm-comment"># Re-raise same exception</span></pre><pre><span class="cm-null">            </span><span class="cm-keyword">return</span><span class="cm-null"> </span><span class="cm-variable">False</span></pre><pre><span class="cm-null">        </span><span class="cm-comment"># Don't re-raise</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Swallowing %s inside CM'</span><span class="cm-null"> </span><span class="cm-operator">%</span><span class="cm-null"> </span><span class="cm-variable">ex_type</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">return</span><span class="cm-null"> </span><span class="cm-variable">True</span></pre></div></div></div></div></div></div></div></div></div><div style="display: none;" class="output vbox"></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[20]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 47px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    print 'Inside with statement', cm</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">CM</span><span class="cm-null">() </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">cm</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Inside with statement'</span><span class="cm-null">, </span><span class="cm-variable">cm</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Entering CM
Inside with statement &lt;__main__.CM object at 0x192f8d0&gt;
Exiting CM
Swallowing None inside CM</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[21]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 118px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    print 'Catching KeyError outside CM'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">try</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">CM</span><span class="cm-null">():</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'About to raise KeyError'</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">raise</span><span class="cm-null"> </span><span class="cm-variable">KeyError</span></pre><pre><span class="cm-keyword">except</span><span class="cm-null"> </span><span class="cm-variable">KeyError</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Catching KeyError outside CM'</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Entering CM
About to raise KeyError
Exiting CM
Catching KeyError outside CM</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[22]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 65px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    print 'About to raise ValueError'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">CM</span><span class="cm-null">():</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'About to raise ValueError'</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">raise</span><span class="cm-null"> </span><span class="cm-variable">ValueError</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Entering CM
About to raise ValueError
Exiting CM
Swallowing &lt;type 'exceptions.ValueError'&gt; inside CM</pre></div></div></div></div><div tabindex="2" class="cell text_cell border-box-sizing"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 22px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><h3>Exercises</h3>

<ul>
<li>Write a context manager that logs the entry and exit of a block of code (similar to the
decorator before)</li>
<li>Write a context manager that prints out balanced XML nodes. Use the test code below.</li>
</ul>

<p>Test code:</p>

<pre><code class="prettyprint"><span class="kwd">with</span><span class="pln">&nbsp;node</span><span class="pun">(</span><span class="str">'html'</span><span class="pun">):</span><br><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">with</span><span class="pln">&nbsp;node</span><span class="pun">(</span><span class="str">'body'</span><span class="pun">):</span><br><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">with</span><span class="pln">&nbsp;node</span><span class="pun">(</span><span class="str">'h1'</span><span class="pun">):</span><br><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pln">&nbsp;</span><span class="str">'Page&nbsp;Title'</span><br></code></pre>

<p>You should see the following result:</p>

<pre><code class="prettyprint"><span class="tag">&lt;html&gt;</span><br><span class="tag">&lt;body&gt;</span><br><span class="tag">&lt;h1&gt;</span><br><span class="pln">Page&nbsp;Title</span><br><span class="tag">&lt;/h1&gt;</span><br><span class="tag">&lt;/body&gt;</span><br><span class="tag">&lt;/html&gt;</span><br></code></pre></div></div><div tabindex="2" class="cell text_cell border-box-sizing"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 1px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><h2>Contextlib</h2></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[23]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 30px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>import contextlib</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">import</span><span class="cm-null"> </span><span class="cm-variable">contextlib</span></pre></div></div></div></div></div></div></div></div></div><div style="display: none;" class="output vbox"></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[25]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 153px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>        print 'Exiting block with exception'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-meta">@contextlib</span><span class="cm-variable">.contextmanager</span></pre><pre><span class="cm-keyword">def</span><span class="cm-null"> </span><span class="cm-variable">so_much_easier</span><span class="cm-null">():</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Entering block'</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">try</span><span class="cm-null">:</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">yield</span><span class="cm-null"> </span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Exiting block cleanly'</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">except</span><span class="cm-null">:</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Exiting block with exception'</span></pre></div></div></div></div></div></div></div></div></div><div style="display: none;" class="output vbox"></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[26]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 47px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    print 'Inside block'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">so_much_easier</span><span class="cm-null">():</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Inside block'</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Entering block
Inside block
Exiting block cleanly</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[28]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 65px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    print 'Raising ValueError'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">so_much_easier</span><span class="cm-null">():</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Raising ValueError'</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">raise</span><span class="cm-null"> </span><span class="cm-variable">ValueError</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Entering block
Raising ValueError
Exiting block with exception</pre></div></div></div></div><div tabindex="2" class="cell text_cell border-box-sizing"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 2px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><p><code>contextlib</code> also provides a facility to support the <code>with</code> statement with context manager-like
objects that don't actually support the protocol, but <em>do</em> have a <code>close()</code> method:</p></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[29]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 100px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>        print 'Perform some resource acquisition'</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">class</span><span class="cm-null"> </span><span class="cm-variable">MyClass</span><span class="cm-null">(</span><span class="cm-builtin">object</span><span class="cm-null">):</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">def</span><span class="cm-null"> </span><span class="cm-variable">__init__</span><span class="cm-null">(</span><span class="cm-variable">self</span><span class="cm-null">):</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Perform some resource acquisition'</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">def</span><span class="cm-null"> </span><span class="cm-variable">close</span><span class="cm-null">(</span><span class="cm-variable">self</span><span class="cm-null">):</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'Close the resource'</span></pre></div></div></div></div></div></div></div></div></div><div style="display: none;" class="output vbox"></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[30]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 47px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>with contextlib.closing(MyClass()) as myobj:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">contextlib.closing</span><span class="cm-null">(</span><span class="cm-variable">MyClass</span><span class="cm-null">()) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">myobj</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'myobj is'</span><span class="cm-null">, </span><span class="cm-variable">myobj</span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Perform some resource acquisition
myobj is &lt;__main__.MyClass object at 0x19c4450&gt;
Close the resource</pre></div></div></div></div><div tabindex="2" class="cell border-box-sizing code_cell vbox"><div class="input hbox"><div class="prompt input_prompt">In&nbsp;[31]:</div><div class="input_area box-flex1"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px; top: 0px; left: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-ipython"><div style="position: relative; height: 135px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre><span>    with contextlib.closing(MyClass()) as myobj:</span></pre></div><div style="position: relative; top: 0px;"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative;" draggable="true"><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style=""><pre><span class="cm-keyword">try</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">with</span><span class="cm-null"> </span><span class="cm-variable">contextlib.closing</span><span class="cm-null">(</span><span class="cm-variable">MyClass</span><span class="cm-null">()) </span><span class="cm-keyword">as</span><span class="cm-null"> </span><span class="cm-variable">myobj</span><span class="cm-null">:</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'raising ValueError'</span></pre><pre><span class="cm-null">        </span><span class="cm-keyword">raise</span><span class="cm-null"> </span><span class="cm-variable">ValueError</span></pre><pre><span class="cm-keyword">except</span><span class="cm-null">:</span></pre><pre><span class="cm-null">    </span><span class="cm-keyword">print</span><span class="cm-null"> </span><span class="cm-string">'handling exception'</span></pre><pre><span class="cm-null">        </span></pre></div></div></div></div></div></div></div></div></div><div style="display: -moz-box;" class="output vbox"><div class="hbox output_area"><div class="prompt"></div><div class="box_flex1 output_subarea output_text output_stream output_stdout"><pre>Perform some resource acquisition
raising ValueError
Close the resource
handling exception</pre></div></div></div></div><div tabindex="2" class="cell text_cell border-box-sizing"><div style="display: none;" class="text_cell_input"><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 2px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default"><div style="position: relative; height: 3px;"><div style="position: absolute; height: 0; width: 0; overflow: hidden;"><pre>x</pre></div><div style="position: relative"><div style="display: none;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative" draggable="true"><pre class="CodeMirror-cursor">&nbsp;</pre><div></div></div></div></div></div></div></div></div><div tabindex="-1" class="text_cell_render rendered_html"><h3>Exercises</h3>

<ul>
<li>Update your context managers from the previous exercise to use the <code>@contextmanager</code> decorator</li>
</ul></div></div><div style="height: 30%;" class="end_space"></div></body></html>